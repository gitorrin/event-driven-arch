AWSTemplateFormatVersion: 2010-09-09
Description: eventbridge-inside-aws
Transform:
- AWS::Serverless-2016-10-31
Resources:
  NotesEventBus:
    Type: AWS::Events::EventBus
    Properties:
      Name: Notes
  NotesLogGroup:
    Type: AWS::Logs::LogGroup
    Properties:
      RetentionInDays: 3
      LogGroupName: /aws/events/notes
  NotesDevRule:
    Type: AWS::Events::Rule
    Properties:
      EventBusName:
        Ref: NotesEventBus
      Name: NotesDevRule
      EventPattern:
        Fn::Sub: '{ "account": [ "${AWS::AccountId}" ] }'
      Targets:
      - Id: NotesLogs
        Arn:
          Fn::Sub: arn:aws:logs:${AWS::Region}:${AWS::AccountId}:log-group:${NotesLogGroup}
  NotesLogGroupTargetRole:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Version: 2012-10-17
        Statement:
        - Effect: Allow
          Principal:
            Service: events.amazonaws.com
          Action: sts:AssumeRole
      Policies:
      - PolicyName: AllowLogging
        PolicyDocument:
          Version: '2012-10-17'
          Statement:
          - Effect: Allow
            Action:
            - logs:*
            Resource: '*'
